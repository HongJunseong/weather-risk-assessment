# ðŸŒ ìž¬í•´ ëŒ€ì‘ì„ ìœ„í•œ ì¤€ì‹¤ì‹œê°„ ê¸°ìƒ ìœ„í—˜ **í‰ê°€** ì‹œìŠ¤í…œ  
*Near Real-time Weather Risk **Assessment** System*

![python](https://img.shields.io/badge/Python-3.11-blue)
![airflow](https://img.shields.io/badge/Apache%20Airflow-2.7.3-017CEE)
![postgresql](https://img.shields.io/badge/PostgreSQL-15-336791)
![tableau](https://img.shields.io/badge/Tableau-Visualization-orange)
![kepler.gl](https://img.shields.io/badge/kepler.gl-Geospatial-00C2A0)

> **ìš”ì•½ í•œ ì¤„**: ê¸°ìƒì²­ APIë¥¼ 30ë¶„ ë‹¨ìœ„ë¡œ ìˆ˜ì§‘í•´ **ì¤€ì‹¤ì‹œê°„(near real-time)** ìœ¼ë¡œ ìœ„í—˜ë„ë¥¼ **í‰ê°€/ì‚°ì¶œ**í•˜ê³ , **Tableau**ì™€ **kepler.gl**ë¡œ ì§ê´€ì ìœ¼ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤. í˜„ìž¬ **Parquet + PostgreSQL ë³‘í–‰ ìš´ì˜**ìœ¼ë¡œ ë¡œì»¬ ê²€ì¦ê³¼ DB ê¸°ë°˜ ìžë™í™”ë¥¼ ë™ì‹œì— ì§€ì›í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

---

## ðŸ—‚ ëª©ì°¨
- [í”„ë¡œì íŠ¸ ìš”ì•½](#-í”„ë¡œì íŠ¸-ìš”ì•½)
- [í”„ë¡œì íŠ¸ ë°°ê²½](#-í”„ë¡œì íŠ¸-ë°°ê²½)
- [ê¸°ì¡´ í•œê³„ì™€ í•´ê²°](#-ê¸°ì¡´-í•œê³„ì™€-í•´ê²°)
- [ë°ì´í„° êµ¬ì„±](#-ë°ì´í„°-êµ¬ì„±)
- [ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±](#-ì „ì²´-ì‹œìŠ¤í…œ-êµ¬ì„±)
- [ê²°ê³¼ ë° ì‹œê°í™”](#-ê²°ê³¼-ë°-ì‹œê°í™”)
- [ê¸°ìˆ ì  ë„ì „ ê³¼ì œ](#-ê¸°ìˆ ì -ë„ì „-ê³¼ì œ)
- [ì¸í”„ë¼ ë° ê°œë°œ í™˜ê²½](#-ì¸í”„ë¼-ë°-ê°œë°œ-í™˜ê²½)
- [PostgreSQL ë„ìž… ì˜ì˜](#-postgresql-ë„ìž…-ì˜ì˜)

---

## ðŸ“Œ í”„ë¡œì íŠ¸ ìš”ì•½
- **ëª©í‘œ**: íƒœí’Â·UVÂ·ë‹¨ê¸°ì˜ˆë³´ ë“± ë‹¤ì–‘í•œ ê¸°ìƒ ì§€í‘œë¥¼ í†µí•©í•˜ì—¬ **ì§€ì—­ë³„ ê¸°ìƒ ìœ„í—˜ë„**ë¥¼ **30ë¶„ ì£¼ê¸°**ë¡œ í‰ê°€í•˜ê³  ì‹œê°í™”
- **í•µì‹¬**: Airflow ê¸°ë°˜ ìžë™í™” íŒŒì´í”„ë¼ì¸ â†’ Parquet/DB ì €ìž¥ â†’ Tableau/kepler.gl ëŒ€ì‹œë³´ë“œ
- **í˜„ìž¬ ìš´ì˜**: **Parquet(ë¡œì»¬ í™•ì¸/ë°±ì—…) + PostgreSQL(ì‹œê°í™”/ìžë™í™”)** ë³‘í–‰  
- **ìš©ì–´**: *ì˜ˆì¸¡(prediction)*ì´ ì•„ë‹ˆë¼ **í‰ê°€(assessment)/ì‚°ì¶œ(computation)/ëª¨ë‹ˆí„°ë§(monitoring)** ì¤‘ì‹¬

---

## ðŸ— í”„ë¡œì íŠ¸ ë°°ê²½
- ê·¹í•œ ê¸°ìƒ(íƒœí’/í­ìš°/í­ì—¼) ë¹ˆë„ ì¦ê°€ â†’ **ì‹œì˜ì„± ë†’ì€ ìœ„í—˜ë„ ì œê³µ** í•„ìš”
- ê¸°ìƒì²­ APIëŠ” ë‹¨íŽ¸ì  ì§€í‘œ ì œê³µ â†’ **ì¢…í•© ìœ„í—˜ë„** ë¶€ìž¬
- ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ: **ìˆ˜ë™ ê°±ì‹ **Â·**ë‹¨ì¼ ì§€í‘œ ì¤‘ì‹¬** â†’ ì¦‰ê°ì  ì˜ì‚¬ê²°ì •ì— í•œê³„

---

## âš  ê¸°ì¡´ í•œê³„ì™€ í•´ê²°
| ê¸°ì¡´ í•œê³„ | ë³¸ í”„ë¡œì íŠ¸ì˜ í•´ê²° |
|---|---|
| ë‹¨ì¼ ì§€í‘œ ì¤‘ì‹¬(ì˜ˆ: ê°•ìˆ˜ëŸ‰ë§Œ) | íƒœí’Â·UVÂ·ë‹¨ê¸°ì˜ˆë³´ **ë‹¤ì¤‘ ì§€í‘œ í†µí•©** ìœ„í—˜ë„ ì‚°ì¶œ |
| ë°°ì¹˜Â·ìˆ˜ë™ ê°±ì‹  | **Airflow**ë¡œ 30ë¶„ ì£¼ê¸° **ìžë™í™”** |
| íŒŒì¼ ê¸°ë°˜ë§Œ ì‚¬ìš© | **PostgreSQL ì—°ë™**ìœ¼ë¡œ ë¬´ê²°ì„±/í™•ìž¥ì„±/ìžë™í™” ê°•í™” |
| ì§€ë„ ì‹œê°í™” ì •ì /ë‹¨íŽ¸ | **Tableau(ë¶„ì„)** + **kepler.gl(ë™ì  ê³µê°„/ì‹œê°„)** ê²°í•© |

---

## ðŸ“Š ë°ì´í„° êµ¬ì„±
- **ì¶œì²˜**: ê¸°ìƒì²­ API
  - ì´ˆë‹¨ê¸°ì˜ˆë³´(ê¸°ì˜¨Â·ê°•ìˆ˜Â·í’ì† ë“±), ë‹¨ê¸°ì˜ˆë³´(ì‹œê°„ë³„ ë³€í™”)
  - ìƒí™œê¸°ìƒì§€ìˆ˜(UV Index), íƒœí’ ì˜ˆì¸¡(ìœ„ì¹˜Â·ê±°ë¦¬Â·ìµœëŒ€ í’ì†)
- **ì²˜ë¦¬**: API â†’ pandas ì „ì²˜ë¦¬ â†’ **ê°€ì¤‘ì¹˜(â€» `risk/weights.yaml`)** ì ìš© â†’ `risk_latest.parquet` ì‚°ì¶œ
- **ì €ìž¥**: Parquet/CSV(ë¡œì»¬ ê²€ì¦) + **PostgreSQL**(ì‹œê°í™”Â·ìžë™í™”)

---

## ðŸ”§ ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±
ê¸°ìƒì²­ API
â”‚
â–¼
pandas ì „ì²˜ë¦¬/ê°€ê³µ
â”œâ”€â”€â–º Parquet/CSV ì €ìž¥ â”€â”€â–º ë¡œì»¬ ê²€ì¦/ë°±ì—…
â””â”€â”€â–º PostgreSQL ì ìž¬ â”€â”€â–º Tableau ë¼ì´ë¸Œ ì—°ê²° / kepler.gl(ì¿¼ë¦¬ ê²°ê³¼ Export)

(ëª¨ë“  ë‹¨ê³„ëŠ” Airflow DAGë¡œ 30ë¶„ ì£¼ê¸° ìžë™ ì‹¤í–‰)


- **Airflow DAG**: ì£¼ê¸° ì‹¤í–‰ Â· ì˜¤ë¥˜ ë¡œê·¸ Â· ìžë™ ìž¬ì‹œë„(ë°±ì˜¤í”„)
- **ì‹¬ë³¼ë¦­ ë§í¬ `data/latest/`**: ìµœì‹  ì‚°ì¶œë¬¼ì— ê³ ì • ê²½ë¡œë¡œ ì ‘ê·¼
- **íƒ€ìž„ì¡´**: `Asia/Seoul`(KST) ê¸°ì¤€ ìŠ¤ì¼€ì¤„ë§

---

## ðŸ“ˆ ê²°ê³¼ ë° ì‹œê°í™”

### 1) Tableau ëŒ€ì‹œë³´ë“œ
- ì§€ì—­ë³„ **í†µí•© ìœ„í—˜ë„/ì§€í‘œ ë¹„êµ**(UV, íƒœí’ ê±°ë¦¬, ê°•ìˆ˜ ë“±)
- íˆ´íŒì—ì„œ **ì˜ˆì¸¡ ì‹œê° Â· ì„¸ë¶€ ì§€í‘œ** í™•ì¸
- **PostgreSQL ë¼ì´ë¸Œ ì—°ê²°** ì‹œ Airflow ê°±ì‹  â†’ ëŒ€ì‹œë³´ë“œ **ìžë™ ë°˜ì˜**
- ìŠ¤í¬ë¦°ìƒ· ì˜ˆì‹œ(êµì²´): `dashboards/tableau_overview.png`

### 2) kepler.gl ì‹œê°í™”
- **í–‰ì •êµ¬ì—­ ì¤‘ì‹¬ ì¢Œí‘œ** ê¸°ë°˜ ê³µê°„ ì‹œê°í™”
- **ì‹œê°„ ìŠ¬ë¼ì´ë”**ë¡œ ì‹œê°„ë³„ ìœ„í—˜ë„ ë³€í™” ì¶”ì 
- ì• ë‹ˆë©”ì´ì…˜/GIFë¡œ **ë™ì  ê³µìœ ** ê°€ëŠ¥
- ì˜ˆì‹œ(êµì²´): `dashboards/kepler_timelapse.gif`

---

## ðŸ§© ê¸°ìˆ ì  ë„ì „ ê³¼ì œ
1. **ì´ì§ˆì  API ì‘ë‹µ(XML/JSON) í†µí•©** â†’ ê³µí†µ íŒŒì„œ + pandas ìŠ¤í‚¤ë§ˆ í‘œì¤€í™”
2. **ì‹œê°„ëŒ€ ì •ë ¬/ê²°ì¸¡ì¹˜ ì²˜ë¦¬** â†’ `pendulum`ìœ¼ë¡œ íƒ€ìž„ì¡´ ì¼ì›í™”(KST) ë° ë³´ì •
3. **DAG ì•ˆì •ì„± ê°•í™”** â†’ ìž¬ì‹œë„/ë°±ì˜¤í”„ ì „ëžµ, êµ¬ì¡°í™”ëœ ë¡œê¹…
4. **DB ì „í™˜ ë³‘í–‰ ìš´ì˜** â†’ Parquet + PostgreSQL ë™ì‹œ ìš´ì˜, Tableau/kepler.gl ì—°ë™ ê²€ì¦

---

## ðŸ–¥ ì¸í”„ë¼ ë° ê°œë°œ í™˜ê²½
- **ì–¸ì–´/ë¼ì´ë¸ŒëŸ¬ë¦¬**: Python 3.11, pandas, requests, pendulum
- **ì›Œí¬í”Œë¡œìš°**: Apache Airflow 2.7.3 (Docker Compose)
- **ì €ìž¥ì†Œ**: Parquet/CSV + **PostgreSQL 15**
- **ì‹œê°í™”**: **Tableau Public**, **kepler.gl**
- **ìš´ì˜**: GitHub Actions(CI/CD), Docker

---

## ðŸ—„ PostgreSQL ë„ìž… ì˜ì˜

**ì™œ DBê¹Œì§€?** íŒŒì¼ ëŒ€ë¹„ **ë¬´ê²°ì„±/ìžë™í™”/í™•ìž¥ì„±**ì—ì„œ ìž¥ì ì´ í½ë‹ˆë‹¤.

- **ë°ì´í„° ê´€ë¦¬/ë¬´ê²°ì„±**: PKÂ·Index ê¸°ë°˜ìœ¼ë¡œ **ì¤‘ë³µ ì œì–´/í’ˆì§ˆ ë³´ìž¥**
- **ì—…ì„œíŠ¸(UPSERT)**: 30ë¶„ ì£¼ê¸° ê°±ì‹  ì‹œ **ì¤‘ë³µ ì—†ì´ ìµœì‹ í™”**
- **SQL íƒìƒ‰ì„±**: ì¡°ê±´/ì§‘ê³„/ì¡°ì¸ ê¸°ë°˜ **ì¦‰ì‹œ ë¶„ì„**
- **ì§€ë¦¬ê³µê°„ í™•ìž¥(PostGIS)**: íƒœí’ ê²½ë¡œ/ë²„í¼/í´ë¦¬ê³¤ êµì°¨ ë“± **ê³µê°„ ë¶„ì„** ê³ ë„í™”

### DDL ì˜ˆì‹œ (ìµœì†Œ ìŠ¤í‚¤ë§ˆ)

```sql
CREATE TABLE IF NOT EXISTS risk_latest (
  fcst_time      timestamptz NOT NULL,
  admin_code     varchar(20) NOT NULL,
  r_total        numeric,
  uv_index       numeric,
  ty_distance_km numeric,
  precip_mm      numeric,
  PRIMARY KEY (fcst_time, admin_code)
);

CREATE INDEX IF NOT EXISTS idx_risk_latest_time  ON risk_latest (fcst_time);
CREATE INDEX IF NOT EXISTS idx_risk_latest_admin ON risk_latest (admin_code);

-- ê³µê°„ë°ì´í„° í™•ìž¥ ì‹œ:
-- CREATE EXTENSION IF NOT EXISTS postgis;
-- ALTER TABLE risk_latest ADD COLUMN geom geometry(Point, 4326);

```

### ë¶„ì„ ì¿¼ë¦¬ ì˜ˆì‹œ

```sql
-- ìµœê·¼ 6ì‹œê°„ ì§€ì—­ë³„ í‰ê·  ìœ„í—˜ë„ Top-N
SELECT admin_code, ROUND(AVG(r_total)::numeric, 3) AS avg_risk
FROM risk_latest
WHERE fcst_time >= NOW() - interval '6 hours'
GROUP BY admin_code
ORDER BY avg_risk DESC
LIMIT 20;

```
